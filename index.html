<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ€ãƒ¼ãƒ„ã‚²ãƒ¼ãƒ ï½œSingle HTML</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: 255, 255, 255;
      --bg2: 15, 18, 30;
      --card: 255,255,255;
      --accent: 76,110,245; /* indigo */
      --muted: 160,168,190;
      --green: 28,166,76;
      --red: 210,31,60;
      --single-dark: 17,17,17;
      --single-light: 247,247,245;
      --shadow: 3,7,20;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color: rgba(var(--card),0.95);
      background: radial-gradient(1200px 800px at 10% 10%, rgba(76,110,245,.28), transparent 60%),
                  radial-gradient(1200px 900px at 90% 80%, rgba(47,184,150,.28), transparent 60%),
                  linear-gradient(180deg, rgb(var(--bg2)) 0%, rgb(8,10,18) 100%);
    }

    .wrapper{
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px;
    }
    .title{
      font-weight:800; font-size: clamp(22px, 3vw, 32px);
      letter-spacing:.02em;
      color: #fff;
    }
    .subtitle{ color: rgba(255,255,255,.7); font-size:14px }

    .app{
      display:grid; grid-template-columns: 1.1fr .9fr; gap: 18px;
    }

    @media (max-width: 880px){
      .app{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(var(--shadow), .45), inset 0 1px 0 rgba(255,255,255,.08);
      border-radius: 22px; padding: 16px; backdrop-filter: blur(10px);
    }

    .board-wrap{ position: relative; display:flex; align-items:center; justify-content:center; height: 560px; }
    canvas{ width: 520px; height: 520px; border-radius:50%; display:block; }
    .hint{
      position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
      font-size:12px; color: rgba(255,255,255,.7);
      background: rgba(0,0,0,.25); padding:6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
    }

    .controls{ display:grid; gap: 12px; }

    .row{ display:flex; gap:10px; align-items:center; }
    label{ font-size: 13px; color: rgba(255,255,255,.8); width: 80px; }
    select, button, input[type="text"]{
      appearance:none; -webkit-appearance:none; outline:none;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.16);
      color:#fff; padding:10px 12px; border-radius: 12px; font-size:14px;
    }
    button{ cursor:pointer; font-weight:600; letter-spacing:.02em; }
    .btn-accent{ background: linear-gradient(180deg, rgba(var(--accent),.9), rgba(var(--accent),.75)); border: 1px solid rgba(var(--accent),.5); }

    .kpi{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top: 6px;
    }
    .kpi .item{ background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); padding: 12px; border-radius: 14px; text-align:center; }
    .kpi .label{ font-size:12px; color: rgba(255,255,255,.7) }
    .kpi .value{ font-size:22px; font-weight:800; letter-spacing:.02em; }

    .history{ margin-top: 12px; max-height: 230px; overflow:auto; }
    .history table{ width:100%; border-collapse: collapse; font-size:14px; }
    .history th, .history td{ padding:8px 10px; border-bottom: 1px dashed rgba(255,255,255,.12); text-align:center; color: rgba(255,255,255,.9) }
    .history th{ position: sticky; top:0; background: rgba(0,0,0,.25); backdrop-filter: blur(6px); }

    .toast{ position: fixed; inset:auto 16px 16px auto; background: rgba(0,0,0,.65); color:#fff; padding:10px 14px; border-radius: 12px; font-size:14px; border:1px solid rgba(255,255,255,.12); display:none; }

    .legend{ display:flex; gap:8px; align-items:center; justify-content:center; margin-top:8px; font-size:12px; color: rgba(255,255,255,.75) }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block }
    .dot.green{ background: rgb(var(--green)) }
    .dot.red{ background: rgb(var(--red)) }
    .dot.gray{ background: rgba(255,255,255,.75) }

    @media (prefers-reduced-motion: no-preference){
      .pop{ animation: pop .4s ease-out }
      @keyframes pop{ from{ transform: scale(.9); opacity: 0 } to{ transform: scale(1); opacity:1 } }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <div>
        <div class="title">ğŸ¯ ãƒ€ãƒ¼ãƒ„ã‚²ãƒ¼ãƒ </div>
        <div class="subtitle">ãƒœãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦3æŠ•Ã—ã‚¿ãƒ¼ãƒ³ã§å¾—ç‚¹ã—ã‚ˆã†ï¼ˆ301/501/ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼‰ã€‚</div>
      </div>
      <div class="row">
        <button id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>

    <div class="app">
      <section class="card">
        <div class="board-wrap">
          <canvas id="board" width="520" height="520" aria-label="ãƒ€ãƒ¼ãƒ„ãƒœãƒ¼ãƒ‰" role="img"></canvas>
          <div class="hint">ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ãƒ­ãƒ¼ / Z:ä¸€æ‰‹æˆ»ã™ / R:ãƒªã‚»ãƒƒãƒˆ</div>
        </div>
        <div class="legend">
          <span class="dot green"></span>ãƒ€ãƒ–ãƒ«/ãƒˆãƒªãƒ—ãƒ«ï¼ˆç·‘ï¼‰
          <span class="dot red"></span>ãƒ€ãƒ–ãƒ«/ãƒˆãƒªãƒ—ãƒ«ï¼ˆèµ¤ï¼‰
          <span class="dot gray"></span>ã‚·ãƒ³ã‚°ãƒ«
        </div>
      </section>

      <section class="card">
        <div class="controls">
          <div class="row">
            <label for="mode">ãƒ¢ãƒ¼ãƒ‰</label>
            <select id="mode">
              <option value="practice">ç·´ç¿’ï¼ˆåˆè¨ˆåŠ ç®—ã®ã¿ï¼‰</option>
              <option value="301">301</option>
              <option value="501" selected>501</option>
            </select>
          </div>
          <div class="row">
            <label for="player">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
            <input id="player" type="text" placeholder="åå‰ï¼ˆä»»æ„ï¼‰" />
          </div>
          <div class="row">
            <button id="btnUndo">ä¸€æ‰‹æˆ»ã™ (Z)</button>
            <button id="btnNext" class="btn-accent">æ¬¡ã®ã‚¿ãƒ¼ãƒ³</button>
          </div>

          <div class="kpi">
            <div class="item"><div class="label">æ®‹ã‚Šï¼ˆã¾ãŸã¯åˆè¨ˆï¼‰</div><div id="kpiRemain" class="value">501</div></div>
            <div class="item"><div class="label">ã“ã®ã‚¿ãƒ¼ãƒ³</div><div id="kpiTurn" class="value">0</div></div>
            <div class="item"><div class="label">æ®‹ã‚Šãƒ€ãƒ¼ãƒ„</div><div id="kpiDarts" class="value">3</div></div>
          </div>

          <div class="history">
            <table>
              <thead>
                <tr><th>ã‚¿ãƒ¼ãƒ³</th><th>æŠ•ã’ãŸå ´æ‰€</th><th>å¾—ç‚¹</th><th>åˆè¨ˆ/æ®‹ã‚Š</th></tr>
              </thead>
              <tbody id="histBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
  // ====== åŸºæœ¬è¨­å®š ======
  const SECTORS = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]; // ä¸Š(12æ™‚)ã‹ã‚‰æ™‚è¨ˆå›ã‚Š

  // å®Ÿå¯¸ãƒœãƒ¼ãƒ‰(ç›´å¾„=340mm, ãƒ€ãƒ–ãƒ«å¤–=170mm)ã‚’åŸºæº–ã«æ¯”ç‡ã‚’è¨­å®š
  const RATIOS = {
    R: 1.0,                 // ãƒ€ãƒ–ãƒ«å¤–å´ï¼ˆãƒœãƒ¼ãƒ‰å¤–å‘¨ï¼‰
    doubleInner: 160/170,   // ãƒ€ãƒ–ãƒ«å†…å‘¨
    tripleOuter: 107/170,   // ãƒˆãƒªãƒ—ãƒ«å¤–å‘¨
    tripleInner: 99/170,    // ãƒˆãƒªãƒ—ãƒ«å†…å‘¨
    bullOuter: 31.8/170,    // ã‚¢ã‚¦ã‚¿ãƒ¼ãƒ–ãƒ«
    bullInner: 12.7/170     // ã‚¤ãƒ³ãƒŠãƒ¼ãƒ–ãƒ«
  };

  const canvas = document.getElementById('board');
  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, window.devicePixelRatio || 1);

  // ç‰©ç†ãƒ”ã‚¯ã‚»ãƒ«ã§é«˜è§£åƒåº¦åŒ–
  function setupCanvas(){
    const cssSize = 520; // CSSä¸Šã®ã‚µã‚¤ã‚º
    canvas.style.width = cssSize + 'px';
    canvas.style.height = cssSize + 'px';
    canvas.width = Math.floor(cssSize * DPR);
    canvas.height = Math.floor(cssSize * DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0); // åº§æ¨™ã¯CSSãƒ”ã‚¯ã‚»ãƒ«åŸºæº–
  }

  const CENTER = { x: 260, y: 260 };
  const BOARD_R = 240; // CSS pxï¼ˆãŠãŠã‚ˆãï¼‰

  let state = {
    mode: '501',
    startScore: 501,
    remain: 501,
    turnScore: 0,
    dartsLeft: 3,
    throws: [], // ç¾åœ¨ã‚¿ãƒ¼ãƒ³ã®æŠ•æ“² [{x,y,score,txt}]
    history: [], // [{turn, list:[txt,...], delta, remainOrTotal}]
    total: 0,
  };

  // ====== æç”» ======
  function drawBoard(){
    ctx.clearRect(0,0,canvas.width, canvas.height);

    // å¤–å‘¨ã®æŸ”ã‚‰ã‹ã„å½±
    ctx.save();
    ctx.beginPath();
    ctx.arc(CENTER.x, CENTER.y, BOARD_R+10, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,.35)';
    ctx.fill();
    ctx.restore();

    // èƒŒæ™¯å††
    fillCircle(CENTER.x, CENTER.y, BOARD_R, 'rgba(240,240,244,1)');

    // ã‚»ã‚¯ã‚¿ãƒ¼ã®å¡—ã‚Šåˆ†ã‘é–¢æ•°
    function drawRing(innerRatio, outerRatio, colorA, colorB){
      const rIn = BOARD_R * innerRatio;
      const rOut = BOARD_R * outerRatio;
      for(let i=0;i<20;i++){
        const start = (-90 + i*18) * Math.PI/180;
        const end = (-90 + (i+1)*18) * Math.PI/180;
        ctx.beginPath();
        ctx.arc(CENTER.x, CENTER.y, rOut, start, end);
        ctx.arc(CENTER.x, CENTER.y, rIn, end, start, true);
        ctx.closePath();
        ctx.fillStyle = (i%2===0) ? colorA : colorB;
        ctx.fill();
      }
    }

    // ã‚·ãƒ³ã‚°ãƒ«å¤–ï¼ˆãƒˆãƒªãƒ—ãƒ«å¤–ã€œãƒ€ãƒ–ãƒ«å†…ï¼‰
    drawRing(RATIOS.tripleOuter, RATIOS.doubleInner, 'rgb(22,22,22)', 'rgb(247,247,245)');

    // ãƒ€ãƒ–ãƒ«ãƒªãƒ³ã‚°ï¼ˆãƒ€ãƒ–ãƒ«å†…ã€œå¤–ï¼‰
    drawRing(RATIOS.doubleInner, RATIOS.R, `rgb(${getVar('--green')})`, `rgb(${getVar('--red')})`);

    // ã‚·ãƒ³ã‚°ãƒ«å†…ï¼ˆãƒ–ãƒ«å¤–ã€œãƒˆãƒªãƒ—ãƒ«å†…ï¼‰
    drawRing(RATIOS.bullOuter, RATIOS.tripleInner, 'rgb(247,247,245)', 'rgb(22,22,22)');

    // ãƒˆãƒªãƒ—ãƒ«ãƒªãƒ³ã‚°ï¼ˆãƒˆãƒªãƒ—ãƒ«å†…ã€œå¤–ï¼‰
    drawRing(RATIOS.tripleInner, RATIOS.tripleOuter, `rgb(${getVar('--green')})`, `rgb(${getVar('--red')})`);

    // ã‚¢ã‚¦ã‚¿ãƒ¼ãƒ–ãƒ«ï¼ˆ25ï¼‰
    fillCircle(CENTER.x, CENTER.y, BOARD_R*RATIOS.bullOuter, `rgb(${getVar('--green')})`);
    // ã‚¤ãƒ³ãƒŠãƒ¼ãƒ–ãƒ«ï¼ˆ50ï¼‰
    fillCircle(CENTER.x, CENTER.y, BOARD_R*RATIOS.bullInner, `rgb(${getVar('--red')})`);

    // ç›®ç››ã‚Šç·šï¼ˆã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰
    ctx.save();
    ctx.strokeStyle = 'rgba(0,0,0,.35)';
    ctx.lineWidth = 1;
    for(let i=0;i<20;i++){
      const a = (-90 + i*18) * Math.PI/180;
      ctx.beginPath();
      ctx.moveTo(CENTER.x + Math.cos(a)*BOARD_R, CENTER.y + Math.sin(a)*BOARD_R);
      ctx.lineTo(CENTER.x + Math.cos(a)*(BOARD_R*RATIOS.bullOuter), CENTER.y + Math.sin(a)*(BOARD_R*RATIOS.bullOuter));
      ctx.stroke();
    }
    ctx.restore();

    // ã‚»ã‚¯ã‚¿ãƒ¼æ•°å­—ï¼ˆå¤–å‘¨ï¼‰
    ctx.save();
    ctx.fillStyle = '#111';
    ctx.font = '600 16px "Noto Sans JP", system-ui';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    for(let i=0;i<20;i++){
      const num = SECTORS[i];
      const a = (-90 + i*18 + 9) * Math.PI/180; // ã‚»ã‚¯ã‚¿ãƒ¼ä¸­å¤®
      const r = BOARD_R*1.06;
      ctx.save();
      ctx.translate(CENTER.x + Math.cos(a)*r, CENTER.y + Math.sin(a)*r);
      ctx.rotate(a + Math.PI/2);
      ctx.fillText(String(num), 0, 0);
      ctx.restore();
    }
    ctx.restore();

    // æ—¢å­˜ã®ãƒ’ãƒƒãƒˆãƒãƒ¼ã‚«ãƒ¼
    drawMarkers();
  }

  function fillCircle(x,y,r,color){
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle = color; ctx.fill();
  }

  const markers = []; // {x,y}
  function drawMarkers(){
    markers.forEach(m=>{
      ctx.save();
      ctx.shadowColor = 'rgba(0,0,0,.35)';
      ctx.shadowBlur = 6;
      fillCircle(m.x, m.y, 4.5, '#fff');
      ctx.restore();
      fillCircle(m.x, m.y, 2, '#333');
    });
  }

  function getVar(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim().replace(/[, ]+/g, ',');
  }

  // ====== ã‚¹ã‚³ã‚¢è¨ˆç®— ======
  function scoreAt(x,y){
    const dx = x - CENTER.x; const dy = y - CENTER.y;
    const r = Math.hypot(dx,dy);
    const angleFromTop = (Math.atan2(dy,dx) * 180/Math.PI + 90 + 360) % 360; // 0Â°ãŒä¸Š
    const sectorIndex = Math.floor(angleFromTop / 18) % 20;
    const base = SECTORS[sectorIndex];

    if(r > BOARD_R) return {score:0, label:'MISS'};
    if(r <= BOARD_R*RATIOS.bullInner) return {score:50, label:'INNER BULL 50'};
    if(r <= BOARD_R*RATIOS.bullOuter) return {score:25, label:'OUTER BULL 25'};

    // ãƒªãƒ³ã‚°åˆ¤å®š
    let mult = 1; let tag = 'S';
    if(r >= BOARD_R*RATIOS.doubleInner) { mult = 2; tag = 'D'; }
    else if(r >= BOARD_R*RATIOS.tripleInner && r <= BOARD_R*RATIOS.tripleOuter){ mult = 3; tag = 'T'; }
    else { mult = 1; tag = 'S'; }

    return { score: base*mult, label: `${tag}${base}` };
  }

  // ====== ã‚²ãƒ¼ãƒ é€²è¡Œ ======
  function setMode(mode){
    state.mode = mode;
    state.startScore = (mode==='301'||mode==='501') ? Number(mode) : 0;
    state.remain = state.startScore || 0;
    state.total = 0;
    state.turnScore = 0;
    state.dartsLeft = 3;
    state.throws = [];
    state.history = [];
    markers.length = 0;
    drawBoard();
    updateUI();
  }

  function addThrow(px,py){
    const {score, label} = scoreAt(px,py);
    markers.push({x:px,y:py});

    if(state.mode==='practice'){
      state.total += score;
      state.turnScore += score;
    }else{
      // ã‚·ãƒ³ãƒ—ãƒ«ãƒ«ãƒ¼ãƒ«ï¼šæ®‹ã‚ŠãŒãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹æŠ•æ“²ã¯0ç‚¹ï¼ˆåŠ ç®—ã—ãªã„ï¼‰
      const nextRemain = state.remain - score;
      if(nextRemain < 0){
        // 0ç‚¹æ‰±ã„
      }else{
        state.remain = nextRemain;
        state.turnScore += score;
      }
      if(state.remain === 0){
        toast('CLEAR! ã´ã£ãŸã‚Šã‚¼ãƒ­ã«ãªã‚Šã¾ã—ãŸğŸ‰');
      }
    }

    state.throws.push({x:px,y:py,score,label});
    state.dartsLeft = Math.max(0, state.dartsLeft - 1);
    drawBoard();
    updateUI();
  }

  function endTurn(){
    const list = state.throws.map(t=>t.label).join(', ');
    const delta = state.turnScore;
    const remainOrTotal = (state.mode==='practice') ? state.total : state.remain;
    const turnNo = state.history.length + 1;
    state.history.push({turn: turnNo, list, delta, remainOrTotal});

    // æ¬¡ã‚¿ãƒ¼ãƒ³æº–å‚™
    state.turnScore = 0;
    state.dartsLeft = 3;
    state.throws = [];
    markers.length = 0; // ã‚¿ãƒ¼ãƒ³ã§åˆºã•ã£ãŸç›®å°ã¯ãƒªã‚»ãƒƒãƒˆ
    drawBoard();
    updateUI();
  }

  function undo(){
    if(state.throws.length===0) return;
    const last = state.throws.pop();
    markers.pop();

    if(state.mode==='practice'){
      state.total -= last.score;
      state.turnScore -= last.score;
    }else{
      // ã‚·ãƒ³ãƒ—ãƒ«ãƒ«ãƒ¼ãƒ«ã§åŠ ç‚¹ã—ã¦ã„ãŸåˆ†ã ã‘æˆ»ã™
      const nextRemain = state.remain + last.score;
      // ãŸã ã—ã€Œæ®‹ã‚ŠãŒãƒã‚¤ãƒŠã‚¹ã ã£ãŸã‹ã‚‰0ç‚¹ã€ã¨ã„ã†ã‚±ãƒ¼ã‚¹ã¯ã€turnScoreã«åŠ ç®—ã•ã‚Œã¦ã„ãªã„ã®ã§ã€
      // state.throws ã‹ã‚‰é€†ç®—ã§ããªã„ã€‚ã“ã“ã§ã¯ã€Œå®Ÿéš›ã«åŠ ç®—ã•ã‚Œã¦ã„ãŸã‚‰æˆ»ã™ã€ã¨ã„ã†æŒ™å‹•ã«ã™ã‚‹ã€‚
      // åˆ¤å®šã¯ã€turnScoreã«last.scoreãŒå«ã¾ã‚Œã¦ã„ãŸã‹ã§ç–‘ä¼¼çš„ã«åˆ¤æ–­
      if(state.turnScore - last.score >= 0){
        state.turnScore -= last.score;
        state.remain = nextRemain;
      }
      if(state.remain > state.startScore) state.remain = state.startScore;
    }
    state.dartsLeft = Math.min(3, state.dartsLeft + 1);
    drawBoard();
    updateUI();
  }

  function updateUI(){
    const kRemain = document.getElementById('kpiRemain');
    const kTurn = document.getElementById('kpiTurn');
    const kDarts = document.getElementById('kpiDarts');
    const body = document.getElementById('histBody');

    kRemain.textContent = (state.mode==='practice') ? state.total : state.remain;
    kTurn.textContent = state.turnScore;
    kDarts.textContent = state.dartsLeft;

    body.innerHTML = state.history.map(h=>
      `<tr><td>${h.turn}</td><td>${h.list||'-'}</td><td>${h.delta}</td><td>${h.remainOrTotal}</td></tr>`
    ).join('');
  }

  function toast(msg){
    const el = document.getElementById('toast');
    el.textContent = msg; el.style.display='block'; el.classList.add('pop');
    setTimeout(()=>{ el.style.display='none'; el.classList.remove('pop'); }, 1800);
  }

  // ====== å…¥åŠ›å‡¦ç† ======
  function getCanvasPos(evt){
    const rect = canvas.getBoundingClientRect();
    const x = (evt.clientX - rect.left);
    const y = (evt.clientY - rect.top);
    return {x, y}; // CSS pxåŸºæº–ï¼ˆctxã¯DPRå¤‰æ›æ¸ˆã¿ï¼‰
  }

  canvas.addEventListener('click', (e)=>{
    if(state.dartsLeft<=0){ toast('ã“ã®ã‚¿ãƒ¼ãƒ³ã¯3æŠ•ã¾ã§ã§ã™ã€‚æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸ã€‚'); return; }
    const p = getCanvasPos(e);
    addThrow(p.x, p.y);
  });

  document.getElementById('btnNext').addEventListener('click', endTurn);
  document.getElementById('btnUndo').addEventListener('click', ()=>{ undo(); toast('ä¸€æ‰‹æˆ»ã—ã¾ã—ãŸ'); });
  document.getElementById('btnReset').addEventListener('click', ()=>{ setMode(state.mode); toast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ'); });

  document.getElementById('mode').addEventListener('change', (e)=>{
    setMode(e.target.value);
  });

  document.addEventListener('keydown', (e)=>{
    if(e.key==='z' || e.key==='Z'){ undo(); }
    if(e.key==='r' || e.key==='R'){ setMode(state.mode); }
  });

  // ====== åˆæœŸåŒ– ======
  setupCanvas();
  drawBoard();
  setMode('501');
  </script>
</body>
</html>
